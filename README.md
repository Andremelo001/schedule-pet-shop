# üêæ PetShop Management API

Uma API REST robusta para gerenciamento completo de PetShop, desenvolvida com FastAPI e seguindo princ√≠pios de Clean Architecture. O sistema oferece controle total de clientes, pets, agendamentos e servi√ßos veterin√°rios.

## üìã √çndice

- [Sobre o Projeto](#sobre-o-projeto)
- [Funcionalidades](#funcionalidades)
- [Tecnologias](#tecnologias)
- [Arquitetura](#arquitetura)
- [Pr√©-requisitos](#pr√©-requisitos)
- [Instala√ß√£o](#instala√ß√£o)
- [API Endpoints](#api-endpoints)
- [Configura√ß√£o](#configura√ß√£o)

## üéØ Sobre o Projeto

Este projeto foi desenvolvido para modernizar e digitalizar o gerenciamento de petshops, oferecendo uma solu√ß√£o completa para:

- **Gest√£o de Clientes**: Cadastro, atualiza√ß√£o e controle de dados dos propriet√°rios de pets
- **Gerenciamento de Pets**: Registro detalhado dos animais com informa√ß√µes sobre ra√ßa, idade e caracter√≠sticas
- **Sistema de Agendamentos**: Controle de consultas e servi√ßos com data e hor√°rio
- **Cat√°logo de Servi√ßos**: Gest√£o de tipos de servi√ßos oferecidos com pre√ßos e dura√ß√£o
- **Autentica√ß√£o Segura**: Sistema de login diferenciado para administradores e clientes
- **Controle de Acesso**: Middleware de autentica√ß√£o com JWT tokens

## ‚ú® Funcionalidades

### üë• Gest√£o de Clientes
- ‚úÖ Cadastro de novos clientes
- ‚úÖ Autentica√ß√£o com email e senha
- ‚úÖ Busca de clientes (apenas administradores)
- ‚úÖ Atualiza√ß√£o de dados (apenas administradores)
- ‚úÖ Exclus√£o de contas (apenas administradores)

### üêï Gest√£o de Pets
- ‚úÖ Cadastro de pets vinculados aos clientes
- ‚úÖ Listagem de todos os pets do cliente
- ‚úÖ Busca espec√≠fica de pets
- ‚úÖ Atualiza√ß√£o de informa√ß√µes dos pets
- ‚úÖ Exclus√£o de registros de pets

### üóìÔ∏è Sistema de Agendamentos
- ‚úÖ Cria√ß√£o de agendamentos com m√∫ltiplos servi√ßos
- ‚úÖ Valida√ß√£o de conflitos de hor√°rio
- ‚úÖ Limita√ß√£o de at√© 3 servi√ßos por agendamento
- ‚úÖ Controle de dura√ß√£o m√°xima (120 minutos)
- ‚úÖ Valida√ß√£o de dias √∫teis (n√£o funciona aos domingos)
- ‚úÖ Listagem de agendamentos (admins)
- ‚úÖ Visualiza√ß√£o de agendamentos ativos
- ‚úÖ Cancelamento de agendamentos com notifica√ß√£o por email
- ‚úÖ Solicita√ß√£o de cancelamento com token JWT
- ‚úÖ Exclus√£o de agendamentos (com valida√ß√£o de data)

### üõ†Ô∏è Gest√£o de Servi√ßos
- ‚úÖ Cadastro de novos tipos de servi√ßos
- ‚úÖ Defini√ß√£o de dura√ß√£o e pre√ßos dos servi√ßos
- ‚úÖ Listagem de todos os servi√ßos dispon√≠veis
- ‚úÖ Atualiza√ß√£o de servi√ßos (com valida√ß√£o de agendamentos)
- ‚úÖ Exclus√£o de servi√ßos (com prote√ß√£o contra agendamentos ativos)
- ‚úÖ Relacionamento muitos-para-muitos com agendamentos

### üìß Sistema de Notifica√ß√µes
- ‚úÖ Envio de emails autom√°ticos para cancelamento
- ‚úÖ Configura√ß√£o SMTP para envio de emails
- ‚úÖ Templates personalizados para notifica√ß√µes
- ‚úÖ Notifica√ß√£o apenas para o cliente propriet√°rio

### üîê Seguran√ßa
- ‚úÖ Autentica√ß√£o JWT diferenciada (Admin/Cliente)
- ‚úÖ Hash de senhas com bcrypt
- ‚úÖ Middleware de autoriza√ß√£o por perfil
- ‚úÖ Tokens espec√≠ficos para cancelamento
- ‚úÖ Valida√ß√£o de permiss√µes por endpoint
- ‚úÖ Prote√ß√£o de rotas sens√≠veis

## üõ†Ô∏è Tecnologias

### Backend
- **[Python 3.12+](https://python.org/)** - Linguagem de programa√ß√£o
- **[FastAPI](https://fastapi.tiangolo.com/)** - Framework web moderno e r√°pido
- **[SQLModel](https://sqlmodel.tiangolo.com/)** - ORM moderno baseado no SQLAlchemy
- **[PostgreSQL](https://postgresql.org/)** - Banco de dados relacional
- **[Alembic](https://alembic.sqlalchemy.org/)** - Migrations do banco de dados

### Seguran√ßa & Autentica√ß√£o
- **[PyJWT](https://pyjwt.readthedocs.io/)** - Gera√ß√£o e valida√ß√£o de tokens JWT
- **[Passlib](https://passlib.readthedocs.io/)** - Hash de senhas
- **[python-decouple](https://github.com/henriquebastos/python-decouple)** - Gerenciamento de vari√°veis de ambiente

### Comunica√ß√£o
- **[SMTP](https://docs.python.org/3/library/smtplib.html)** - Envio de emails para notifica√ß√µes
- **[SSL](https://docs.python.org/3/library/ssl.html)** - Conex√µes seguras para email

### Desenvolvimento & Testes
- **[Pytest](https://pytest.org/)** - Framework de testes
- **[Pytest-asyncio](https://pytest-asyncio.readthedocs.io/)** - Suporte a testes ass√≠ncronos
- **[Pytest-mock](https://pytest-mock.readthedocs.io/)** - Mocking para testes
- **[Ruff](https://github.com/astral-sh/ruff)** - Linter e formatter
- **[Pylint](https://pylint.pycqa.org/)** - An√°lise est√°tica de c√≥digo

### DevOps
- **[Docker](https://docker.com/)** - Containeriza√ß√£o
- **[Docker Compose](https://docs.docker.com/compose/)** - Orquestra√ß√£o de containers

## üèóÔ∏è Arquitetura

O projeto segue os princ√≠pios da **Clean Architecture**, garantindo:

- **Separa√ß√£o de responsabilidades**
- **Baixo acoplamento**
- **Alta coes√£o**
- **Testabilidade**
- **Manutenibilidade**

### Estrutura de Pastas

```
src/
‚îú‚îÄ‚îÄ main/                    # Camada de apresenta√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ routes/             # Defini√ß√£o das rotas da API
‚îÇ   ‚îú‚îÄ‚îÄ adapters/           # Adaptadores de requisi√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ composers/          # Inje√ß√£o de depend√™ncias
‚îÇ   ‚îî‚îÄ‚îÄ server/            # Configura√ß√£o do servidor
‚îú‚îÄ‚îÄ modules/               # M√≥dulos de neg√≥cio
‚îÇ   ‚îú‚îÄ‚îÄ authenticate_admin/ # Autentica√ß√£o de administradores
‚îÇ   ‚îú‚îÄ‚îÄ authenticate_user/  # Autentica√ß√£o de usu√°rios
‚îÇ   ‚îú‚îÄ‚îÄ pet/               # Dom√≠nio de pets
‚îÇ   ‚îú‚îÄ‚îÄ schedule/          # Dom√≠nio de agendamentos
‚îÇ   ‚îî‚îÄ‚îÄ user/              # Dom√≠nio de usu√°rios
‚îú‚îÄ‚îÄ infra/                 # Camada de infraestrutura
‚îÇ   ‚îî‚îÄ‚îÄ db/               # Configura√ß√µes do banco
‚îÇ       ‚îú‚îÄ‚îÄ entities/     # Entidades do banco
‚îÇ       ‚îî‚îÄ‚îÄ repositories/ # Reposit√≥rios
‚îú‚îÄ‚îÄ drivers/              # Drivers externos
‚îÇ   ‚îú‚îÄ‚îÄ jwt/             # Servi√ßos JWT
‚îÇ   ‚îî‚îÄ‚îÄ password_hasher/ # Hash de senhas
‚îú‚îÄ‚îÄ middlewares/          # Middlewares de autentica√ß√£o
‚îú‚îÄ‚îÄ errors/              # Tratamento de erros
‚îî‚îÄ‚îÄ tests/               # Testes automatizados
```

## üìã Pr√©-requisitos

- **Python 3.12+**
- **Docker** e **Docker Compose**
- **Git**

> **‚ö†Ô∏è Importante**: Certifique-se de criar o arquivo `.env` com as configura√ß√µes corretas antes de executar a aplica√ß√£o. Veja a se√ß√£o [Configura√ß√£o](#%EF%B8%8F-configura√ß√£o) para mais detalhes.

## üöÄ Instala√ß√£o

### üê≥ Op√ß√£o 1: Instala√ß√£o com Docker (Recomendada)

#### 1. Clone o reposit√≥rio
```bash
git clone https://github.com/Andremelo001/schedule-pet-shop.git
cd schedule-pet-shop
```

#### 2. Configure as vari√°veis de ambiente
```bash
# Crie o arquivo .env baseado no exemplo
cp .env.example .env
# Edite o arquivo .env com suas configura√ß√µes
```

#### 3. Inicie toda a aplica√ß√£o com Docker
```bash
# Inicia o banco de dados e a aplica√ß√£o
docker-compose up -d --build
```

#### 4. Execute as migrations (primeira vez)
```bash
# Execute as migrations para criar as tabelas
docker-compose exec app alembic upgrade head
```

A API estar√° dispon√≠vel em: `http://localhost:8000`
A documenta√ß√£o da API estar√° em: `http://localhost:8000/docs`

---

### üíª Op√ß√£o 2: Instala√ß√£o Local (Desenvolvimento)

#### 1. Clone o reposit√≥rio
```bash
git clone https://github.com/Andremelo001/schedule-pet-shop.git
cd schedule-pet-shop
```

#### 2. Configure o ambiente virtual
```bash
# Instale o UV (se ainda n√£o tiver)
pip install uv

# Crie e ative o ambiente virtual
uv venv
# No Windows
.venv\Scripts\activate
# No Linux/Mac
source .venv/bin/activate

# Instale as depend√™ncias
uv pip sync pyproject.toml
```

#### 3. Configure as vari√°veis de ambiente
```bash
# Crie o arquivo .env baseado no exemplo
cp .env.example .env
# Edite o arquivo .env com suas configura√ß√µes
```

#### 4. Inicie apenas o banco de dados
```bash
# Inicia apenas o PostgreSQL
docker-compose up db -d
```

#### 5. Execute as migrations
```bash
# Execute as migrations para criar as tabelas
alembic upgrade head
```

#### 6. Inicie a aplica√ß√£o localmente
```bash
fastapi dev src/main/server/server.py
```

A API estar√° dispon√≠vel em: `http://localhost:8000`  
A documenta√ß√£o da API estar√° em: `http://localhost:8000/docs`

## üìã API Endpoints

### üë• Clientes (`/clients`)
- `POST /create` - Cadastrar novo cliente
- `GET /find` - Buscar cliente por CPF (Admin)
- `PUT /update` - Atualizar dados do cliente (Admin)
- `DELETE /delete` - Excluir cliente (Admin)
- `POST /login` - Login de cliente
- `GET /get_client_with_pets_and_schedules` - Relat√≥rio completo (Admin)

### üêï Pets (`/pets`)
- `POST /create` - Cadastrar novo pet (Cliente)
- `GET /get_all_pets` - Listar pets do cliente (Cliente)
- `GET /finder` - Buscar pet espec√≠fico (Cliente)
- `PUT /update` - Atualizar dados do pet (Cliente)
- `DELETE /delete` - Excluir pet (Cliente)

### üìÖ Agendamentos (`/schedules`)
- `POST /create` - Criar agendamento (Cliente)
- `POST /request_cancel_schedule` - Solicitar cancelamento (Cliente)
- `POST /cancel_schedule` - Cancelar agendamento (Token JWT)
- `DELETE /delete` - Excluir agendamento (Admin)
- `GET /list` - Listar todos agendamentos (Admin)
- `GET /list_schedules_actives` - Listar agendamentos ativos (Admin)

### üõ†Ô∏è Servi√ßos (`/services`)
- `POST /create` - Cadastrar servi√ßo (Admin)
- `GET /list` - Listar todos servi√ßos (Admin)
- `PUT /update` - Atualizar servi√ßo (Admin)
- `DELETE /delete` - Excluir servi√ßo (Admin)

### üë®‚Äçüíº Admin (`/admin`)
- `POST /login` - Login de administrador

## ‚öôÔ∏è Configura√ß√£o

### Vari√°veis de Ambiente

Crie um arquivo `.env` na raiz do projeto:

```env
# Banco de Dados PostgreSQL (usado pelo Docker)
POSTGRES_DB=db_petshop
POSTGRES_USER=petshop
POSTGRES_PASSWORD=sua_senha_segura
POSTGRES_PORT=5432

# URL de Conex√£o (usada pela aplica√ß√£o)
DATABASE_URL="postgresql+asyncpg://petshop:sua_senha_segura@db:5432/db_petshop"

# JWT
JWT_SECRET=your-super-secret-jwt-key-muito-segura
JWT_ALGORITHM=HS256
JWT_EXPIRATION_TIME=3600

# Admin
SENHA_ADMIN="sua_senha_admin_segura"

# Email (SMTP) - Configura√ß√£o opcional
EMAIL_HOST="smtp.ethereal.email"
EMAIL_PORT="587"
EMAIL_USERNAME="seu_email"
EMAIL_PASSWORD="senha_email"
```
> **üîí Seguran√ßa**: 
> - Nunca commite o arquivo `.env` no reposit√≥rio
> - Use senhas fortes e √∫nicas
> - Em produ√ß√£o, use vari√°veis de ambiente do sistema

## üèõÔ∏è Modelo de Dados

```mermaid
classDiagram
    direction LR
    class Admin {
        id: uuid
        name: str
        senha: str
        user: str
    }

    class Client {
        id: uuid 
        name: str
        cpf: str
        senha: str
        email: str
        age: int
    }

    class Pet {
        id: uuid
        name: str
        breed: str
        age: int
        size_in_centimeters: int
        id_client: uuid
    }

    class Schedule {
        id: uuid
        date_schedule: date
        time_schedule: time
        id_client: uuid
        id_pet: uuid
        total_price_schedule: int
        schedule_active: bool
    }

    class Services {
        id: uuid
        duration_in_minutes: int
        type_service: str
        price: float
    }

    Client "1" -- "*" Pet
    Client "1" -- "*" Schedule
    Schedule "*" --> "*" Services
    Schedule "*" -- "1" Pet
``` 

## üë®‚Äçüíª Autor

**Andr√© Melo**
- GitHub: [@Andremelo001](https://github.com/Andremelo001)
- LinkedIn: [Andr√© Melo](www.linkedin.com/in/melooandree)

---

‚≠ê Se este projeto foi √∫til para voc√™, considere dar uma estrela no reposit√≥rio! 
